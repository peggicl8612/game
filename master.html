<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å‰ä¼Šå¡å“‡æ§åˆ¶å° ğŸ‘‘</title>
    <style>
        body { background: #E0F7FA; font-family: sans-serif; text-align: center; padding: 20px; }
        .admin-box { background: white; border: 4px solid #5A5A5A; border-radius: 20px; padding: 20px; max-width: 500px; margin: auto; }
        input { width: 80%; padding: 10px; margin: 10px; border: 2px solid #5A5A5A; border-radius: 10px; }
        .btn { background: #FFD1DC; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; border: 2px solid #5A5A5A; }
    </style>
</head>
<body>
    <div class="admin-box">
        <h2>ğŸ‘‘ ä¸»æŒäººæ§åˆ¶é¢æ¿</h2>
        <input type="text" id="img-url" placeholder="åœ–ç‰‡ URL">
        <input type="text" id="ans" placeholder="æ­£ç¢ºç­”æ¡ˆ (å¤šå€‹ç”¨é€—è™Ÿéš”é–‹)">
        <br>
        <button class="btn" onclick="sendQ()">ğŸš€ ç™¼å¸ƒé¡Œç›® (15ç§’å€’æ•¸)</button>
        <button class="btn" style="background: #E0F7FA;" onclick="endRound()">ğŸ çµæŸé€™ä¸€é¡Œä¸¦æ’å</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, ref, set, update, onValue } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        const firebaseConfig = {
    apiKey: "AIzaSyBEkuEJ19FQ-0y-KiJeInCUZ7BTv6TuXOE",
    authDomain: "game-3dc74.firebaseapp.com",
     databaseURL: "https://game-3dc74-default-rtdb.asia-southeast1.firebasedatabase.app", 
    projectId: "game-3dc74",
    storageBucket: "game-3dc74.firebasestorage.app",
    messagingSenderId: "239384658458",
    appId: "1:239384658458:web:3986833e5d61fc932a87a3",
    measurementId: "G-Q0J38297L3"
};
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.sendQ = () => {
            const img = document.getElementById('img-url').value;
            const ans = document.getElementById('ans').value.split(',');
            set(ref(db, 'game'), {
                status: "playing",
                imgUrl: img,
                answers: ans,
                startTime: Date.now()
            });
        };

        window.endRound = () => {
            // æŠ“å– gameState çš„ç­”æ¡ˆé€²è¡Œæ¯”åˆ†
            onValue(ref(db, 'game'), (snap) => {
                const state = snap.val();
                const correctOnes = state.answers;
                onValue(ref(db, 'users'), (uSnap) => {
                    const users = uSnap.val();
                    for(let name in users) {
                        if(correctOnes.includes(users[name].lastAns)) {
                            // è¨ˆç®—é€Ÿåº¦åŠ åˆ†
                            const bonus = Math.max(0, 15 - Math.floor((users[name].time - state.startTime)/1000));
                            update(ref(db, 'users/' + name), { 
                                score: users[name].score + 100 + (bonus * 10),
                                lastAns: "" 
                            });
                        }
                    }
                }, { onlyOnce: true });
            }, { onlyOnce: true });
            set(ref(db, 'gameState/status'), "ranking");
        };
    </script>
</body>
</html>